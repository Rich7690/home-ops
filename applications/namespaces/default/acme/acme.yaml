---
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
    name: acme
    namespace: cron
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
    name: acme
roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: cluster-admin
subjects:
    - kind: ServiceAccount
      name: acme
      namespace: cron
---
apiVersion: batch/v1
kind: CronJob
metadata:
    labels:
        app: acme
    name: acme
    namespace: cron
spec:
    concurrencyPolicy: Forbid
    failedJobsHistoryLimit: 1
    jobTemplate:
        metadata:
            labels:
                app: acme
        spec:
            backoffLimit: 5
            completions: 1
            manualSelector: false
            parallelism: 1
            template:
                metadata:
                    labels:
                        app: acme
                spec:
                    automountServiceAccountToken: true
                    containers:
                        - command:
                              - /usr/local/bin/renew.sh
                          image: ghcr.io/rich7690/acme-resolver:latest@sha256:4f1816d152d0288eff50fd492054687e5acdf65963f3419c34e2ada59a46171e
                          imagePullPolicy: IfNotPresent
                          name: acme
                          envFrom:
                            - secretRef:
                                name: njalla
                                optional: false
                          resources:
                              limits:
                                  memory: 512Mi
                              requests:
                                  memory: 64Mi
                          terminationMessagePath: /dev/termination-log
                          terminationMessagePolicy: File
                          volumeMounts:
                              - mountPath: /data
                                mountPropagation: None
                                name: data
                    dnsConfig:
                        options:
                            - name: ndots
                              value: "3"
                        searches:
                            - default.svc.cluster.local
                    dnsPolicy: ClusterFirst
                    enableServiceLinks: true
                    nodeSelector:
                        kubernetes.io/hostname: virtworkerone
                    restartPolicy: Never
                    schedulerName: default-scheduler
                    securityContext: {}
                    serviceAccountName: acme
                    shareProcessNamespace: false
                    terminationGracePeriodSeconds: 30
                    volumes:
                        - hostPath:
                              path: /var/mnt/cache/configs/acme
                          name: data
    schedule: "@daily"
    successfulJobsHistoryLimit: 1
    suspend: false
---
apiVersion: batch/v1
kind: CronJob
metadata:
    labels:
        app: acme-udev
    name: acme-udev
    namespace: cron
spec:
    concurrencyPolicy: Forbid
    failedJobsHistoryLimit: 1
    jobTemplate:
        metadata:
            labels:
                app: acme-udev
        spec:
            backoffLimit: 5
            completions: 1
            manualSelector: false
            parallelism: 1
            template:
                metadata:
                    labels:
                        app: acme-udev
                spec:
                    automountServiceAccountToken: true
                    containers:
                        - command:
                              - /usr/local/bin/renew.sh
                          image: ghcr.io/rich7690/acme-resolver:latest@sha256:4f1816d152d0288eff50fd492054687e5acdf65963f3419c34e2ada59a46171e
                          imagePullPolicy: IfNotPresent
                          name: acme
                          envFrom:
                            - secretRef:
                                name: njalla-udev
                                optional: false
                          resources:
                              limits:
                                  memory: 512Mi
                              requests:
                                  memory: 64Mi
                          terminationMessagePath: /dev/termination-log
                          terminationMessagePolicy: File
                          volumeMounts:
                              - mountPath: /data
                                mountPropagation: None
                                name: data
                    dnsConfig:
                        options:
                            - name: ndots
                              value: "3"
                        searches:
                            - default.svc.cluster.local
                    dnsPolicy: ClusterFirst
                    enableServiceLinks: true
                    nodeSelector:
                        kubernetes.io/hostname: virtworkerone
                    restartPolicy: Never
                    schedulerName: default-scheduler
                    securityContext: {}
                    serviceAccountName: acme
                    shareProcessNamespace: false
                    terminationGracePeriodSeconds: 30
                    volumes:
                        - hostPath:
                              path: /var/mnt/cache/configs/acme
                          name: data
    schedule: "@daily"
    successfulJobsHistoryLimit: 1
    suspend: false
