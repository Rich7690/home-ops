---
apiVersion: batch/v1
kind: CronJob
metadata:
    name: renovate
spec:
    schedule: "@hourly"
    concurrencyPolicy: Forbid
    failedJobsHistoryLimit: 1
    successfulJobsHistoryLimit: 1
    suspend: true
    jobTemplate:
        spec:
            backoffLimit: 1
            template:
                metadata:
                    labels:
                        app: renovate
                spec:
                    automountServiceAccountToken: true
                    containers:
                        - name: renovate
                          image: renovate/renovate:34.70.6@sha256:8bde8527feef32b2371e115cc2829158dbe4ecad5002abc88d4dd19dd604471c
                          imagePullPolicy: IfNotPresent
                          tty: true
                          stdin: true
                          securityContext:
                              allowPrivilegeEscalation: false
                              capabilities:
                                  drop:
                                      - ALL
                              privileged: false
                              readOnlyRootFilesystem: false
                              runAsNonRoot: true
                          command:
                              - bash
                              - -c
                              - export GPG_TTY=$(tty) && echo $(tty) && renovate Rich7690/home-server-config
                          env:
                              - name: LOG_LEVEL
                                value: info
                          envFrom:
                              - secretRef:
                                    name: renovate-env
                    restartPolicy: Never
