---
apiVersion: batch/v1
kind: CronJob
metadata:
    name: renovate
spec:
    schedule: "@hourly"
    concurrencyPolicy: Forbid
    failedJobsHistoryLimit: 1
    successfulJobsHistoryLimit: 1
    jobTemplate:
        spec:
            backoffLimit: 3
            template:
                metadata:
                    labels:
                        app: renovate
                    annotations:
                        vault.security.banzaicloud.io/vault-tls-secret: vault-tls
                spec:
                    automountServiceAccountToken: true
                    containers:
                        - name: renovate
                          image: renovate/renovate:32.236.4@sha256:6e8834788ee0281487adbdd38c32be14af390f149be80988fad9ef5a113fe7ea
                          imagePullPolicy: IfNotPresent
                          tty: true
                          stdin: true
                          securityContext:
                              allowPrivilegeEscalation: false
                              capabilities:
                                  drop:
                                      - ALL
                              privileged: false
                              readOnlyRootFilesystem: false
                              runAsNonRoot: true
                          command:
                              - bash
                              - -c
                              - export GPG_TTY=$(tty) && echo $(tty) && renovate Rich7690/home-server-config
                          env:
                              - name: LOG_LEVEL
                                value: info
                          envFrom:
                              - secretRef:
                                    name: renovate-env
                    restartPolicy: Never
