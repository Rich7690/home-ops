---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: kopia
    namespace: argocd
spec:
    project: remote-apps
    source:
        chart: app-template
        repoURL: https://bjw-s.github.io/helm-charts/
        targetRevision: 0.1.1
        helm:
            releaseName: kopia
            values: |
                nodeSelector:
                  kubernetes.io/hostname: virtworkerone
                image:
                  repository: ghcr.io/onedr0p/kopia
                  tag: 0.11.3@sha256:46eefda38f842c3f03c4329e68f1f8c3be36ea324f11d458724719d8ab2fb53d
                  env:
                    TZ: "America/Los_Angeles"
                    KOPIA_PASSWORD: "none"
                  command: kopia
                  args:
                    - server
                    - --insecure
                    - --address
                    - 0.0.0.0:80
                    - --metrics-listen-addr
                    - 0.0.0.0:8080
                    - --without-password
                service:
                    main:
                      ports:
                        http:
                          port: 80
                        metrics:
                          enabled: true
                          port: 8080
                persistence:
                  snapshots:
                    enabled: true
                    type: hostPath
                    hostPath: /var/mnt/cache
                    mountPath: /snapshots

    destination:
        server: https://kubernetes.default.svc
        namespace: default
