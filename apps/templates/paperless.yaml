apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: paperless
    namespace: argocd
spec:
    project: remote-apps
    source:
        chart: paperless
        repoURL: https://k8s-at-home.com/charts/
        targetRevision: 9.1.3
        helm:
            releaseName: paperless
            values: |
                image:
                  tag: 1.10.1@sha256:5934e3a12d81e23f8b088b3e3843b2990a76eafba760770cae1a18e3287e9167
                controller:
                    replicas: 1
                env:
                    PAPERLESS_HTTP_REMOTE_USER_HEADER_NAME: HTTP_X_AUTH_REQUEST_PREFERRED_USERNAME
                    PAPERLESS_ENABLE_HTTP_REMOTE_USER: true
                    PAPERLESS_REDIS: redis://redis:6379
                    PAPERLESS_PORT: 8000
                    PAPERLESS_TIME_ZONE: America/Los_Angeles
                    USERMAP_GID: 997
                    USERMAP_UID: 998
                ingress:
                    main:
                        enabled: false
                persistence:
                    consume:
                        enabled: true
                        subPath: configs/paperless/config
                        existingClaim: cache-pvc
                        type: pvc
                        retain: true
                    data:
                        enabled: true
                        subPath: configs/paperless/data
                        existingClaim: cache-pvc
                        type: pvc
                        retain: true
                    media:
                        enabled: true
                        subPath: configs/paperless/media
                        existingClaim: cache-pvc
                        type: pvc
                        retain: true
                resources:
                    limits:
                        memory: 4G
                    requests:
                        cpu: 1
                        memory: 4G
    destination:
        server: https://kubernetes.default.svc
        namespace: default
