apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: traefik
    namespace: argocd
spec:
    project: remote-apps
    source:
        chart: traefik
        repoURL: https://helm.traefik.io/traefik
        targetRevision: 20.8.0
        helm:
            releaseName: traefik
            values: |
                deployment:
                  replicas: 2
                image:
                    name: traefik
                    tag: v2.9.6
                    pullPolicy: IfNotPresent
                hub:
                  enabled: true
                ingressClass:
                  enabled: true
                  isDefaultClass: false
                logs:
                  general:
                    level: INFO
                providers:
                  kubernetesIngress:
                    publishedService:
                      enabled: true
                globalArguments:
                  - "--global.checknewversion=false"
                  - "--global.sendanonymoususage=false"
                topologySpreadConstraints:
                  - labelSelector:
                      matchLabels:
                        app.kubernetes.io/instance: traefik-default
                    maxSkew: 1
                    topologyKey: kubernetes.io/hostname
                    whenUnsatisfiable: DoNotSchedule

    destination:
        server: https://kubernetes.default.svc
        namespace: default
