apiVersion: batch/v1
kind: CronJob
metadata:
  labels:
    app: savethespot
  name: savethespot
  namespace: cron
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 1
  jobTemplate:
    metadata:
      labels:
        app: savethespot
    spec:
      backoffLimit: 3
      completions: 1
      manualSelector: false
      parallelism: 1
      template:
        metadata:
          labels:
            app: savethespot
          annotations:
            vault.security.banzaicloud.io/vault-tls-secret: vault-tls
            vault.security.banzaicloud.io/vault-env-from-path: "secret/data/deploy/savethespot"
        spec:
          serviceAccountName: savethespot
          automountServiceAccountToken: true

          containers:
            - image: ghcr.io/rich7690/go-web-crawl:0.0.2@sha256:1ab387f4ff45cd6a41b10634f1d316666ed6ac2a47d5e6dec616e6c9fa8f8727
              imagePullPolicy: IfNotPresent
              name: savethespot
              resources:
                limits:
                  cpu: "4"
                  memory: 1G
                requests:
                  cpu: 200m
                  memory: 512Mi
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
          dnsConfig:
            options:
              - name: ndots
                value: "3"
            searches:
              - default.svc.cluster.local
          dnsPolicy: ClusterFirst
          enableServiceLinks: true
          restartPolicy: Never
          schedulerName: default-scheduler
          securityContext: {}
          shareProcessNamespace: false
          terminationGracePeriodSeconds: 30
  schedule: 0 16 2 * *
  successfulJobsHistoryLimit: 1
  suspend: false
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: savethespot
  namespace: cron
---

